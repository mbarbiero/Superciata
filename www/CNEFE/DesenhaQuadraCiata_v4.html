<!DOCTYPE html>
<html>
<head>
    <title>Polígono com 4 Pontos de Referência</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 100vh; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Inicialização do mapa
        const map = L.map('map').setView([-19.617356, -43.213439], 18);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // Pontos de referência A, B, C e D (exemplo)
        const pontoA = L.latLng(-19.6176553333, -43.214049);
        const pontoB = L.latLng(-19.6170418235, -43.2135045882);
        const pontoC = L.latLng(-19.6172165714, -43.2129124286);
        const pontoD = L.latLng(-19.6176703333, -43.2133737778);
        
        // Marcadores para visualização
        L.marker(pontoA).bindPopup("Ponto A").addTo(map);
        L.marker(pontoB).bindPopup("Ponto B").addTo(map);
        L.marker(pontoC).bindPopup("Ponto C").addTo(map);
        L.marker(pontoD).bindPopup("Ponto D").addTo(map);

        // Função para calcular o centro de vários pontos
        function calcularCentro(pontos) {
            let lat = 0, lng = 0;
            pontos.forEach(ponto => {
                lat += ponto.lat;
                lng += ponto.lng;
            });
            return L.latLng(lat/pontos.length, lng/pontos.length);
        }

        // Função para ordenar pontos em sentido horário
        function ordenarPontos(pontos) {
            const centro = calcularCentro(pontos);
            
            return pontos.sort((a, b) => {
                const anguloA = Math.atan2(a.lat - centro.lat, a.lng - centro.lng);
                const anguloB = Math.atan2(b.lat - centro.lat, b.lng - centro.lng);
                return anguloA - anguloB;
            });
        }

        // Criar polígono com os 4 pontos
        function criarPoligonoQuadrado() {
            const pontos = [pontoA, pontoB, pontoC, pontoD];
            const pontosOrdenados = ordenarPontos(pontos);
            
            // Fechar o polígono conectando o último ponto ao primeiro
            return pontosOrdenados.concat([pontosOrdenados[0]]);
        }

        // Adicionar linhas conectando os pontos em ordem
        L.polyline([pontoA, pontoB, pontoC, pontoD, pontoA], {color: 'red'}).addTo(map);

        // Criar e adicionar o polígono
        const poligono = L.polygon(criarPoligonoQuadrado(), {
            color: 'blue',
            fillOpacity: 0.5,
            weight: 2
        }).addTo(map);

        // Adicionar rótulo com informações
        poligono.bindPopup("Polígono de 4 pontos").openPopup();

        // Centralizar o mapa nos pontos
        const grupo = new L.FeatureGroup([pontoA, pontoB, pontoC, pontoD]);
        map.fitBounds(grupo.getBounds());

        // Adicionar controle de escala em metros
        L.control.scale({imperial: false}).addTo(map);
    </script>
</body>
</html>